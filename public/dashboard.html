<!--
=========================================================
* Material Dashboard 2 - v3.1.0
=========================================================

* Product Page: https://www.creative-tim.com/product/material-dashboard
* Copyright 2023 Creative Tim (https://www.creative-tim.com)
* Licensed under MIT (https://www.creative-tim.com/license)
* Coded by Creative Tim

=========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />
        <link
            rel="apple-touch-icon"
            sizes="76x76"
            href="../assets/img/apple-icon.png"
        />
        <link rel="icon" type="image/png" href="../assets/img/favicon.png" />
        <title>Dashboard</title>
        <!--     Fonts and icons     -->
        <link
            rel="stylesheet"
            type="text/css"
            href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900|Roboto+Slab:400,700"
        />
        <!-- Nucleo Icons -->
        <link href="../assets/css/nucleo-icons.css" rel="stylesheet" />
        <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
        <!-- Font Awesome Icons -->
        <script
            src="https://kit.fontawesome.com/42d5adcbca.js"
            crossorigin="anonymous"
        ></script>
        <!-- Material Icons -->
        <link
            href="https://fonts.googleapis.com/icon?family=Material+Icons+Round"
            rel="stylesheet"
        />
        <!-- CSS Files -->
        <link
            id="pagestyle"
            href="../assets/css/material-dashboard.css?v=3.1.0"
            rel="stylesheet"
        />
        <!-- Nepcha Analytics (nepcha.com) -->
        <!-- Nepcha is a easy-to-use web analytics. No cookies and fully compliant with GDPR, CCPA and PECR. -->
        <script type="module" src="script.js"></script>
    </head>

    <body class="g-sidenav-show bg-gray-200">
        <aside
            class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-3 bg-gradient-dark"
            id="sidenav-main"
        >
            <div class="sidenav-header">
                <i
                    class="fas fa-times p-3 cursor-pointer text-white opacity-5 position-absolute end-0 top-0 d-none d-xl-none"
                    aria-hidden="true"
                    id="iconSidenav"
                ></i>
                <a class="navbar-brand m-0" target="_blank">
                    <div class="d-flex align-items-center">
                        <img
                            src="favicon.png"
                            class="navbar-brand-img h-100"
                            alt="main_logo"
                        />
                        <span
                            class="ms-1 font-weight-bold text-white"
                            style="margin-left: 15px !important"
                        >
                            <div id="user-info"></div>
                        </span>
                    </div>
                </a>
            </div>
            <hr class="horizontal light mt-0 mb-2" />
            <div
                class="collapse navbar-collapse w-auto"
                id="sidenav-collapse-main"
            >
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a
                            class="nav-link text-white active bg-gradient-primary"
                            href="../pages/dashboard.html"
                        >
                            <div
                                class="text-white text-center me-2 d-flex align-items-center justify-content-center"
                            >
                                <i class="material-icons opacity-10"
                                    >dashboard</i
                                >
                            </div>
                            <span class="nav-link-text ms-1">Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a
                            class="nav-link text-white"
                            href="https://app.slack.com/client/T06FM1QSH8A/C06LKC31QJD?cdn_fallback=1"
                            target="_blank"
                        >
                            <div
                                class="text-white text-center me-2 d-flex align-items-center justify-content-center"
                            >
                                <i
                                    class="fab fa-slack opacity-10"
                                    style="
                                        transform: scale(1.5);
                                        margin-left: 4px;
                                        margin-right: 4px;
                                    "
                                ></i>
                            </div>
                            <span class="nav-link-text ms-1">Slack</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a
                            class="nav-link text-white"
                            href="https://drive.google.com/drive/u/1/folders/1VSnhqMMidgB2dlyEJnsh_VU7P2gkNHOx"
                            target="_blank"
                        >
                            <div
                                class="text-white text-center me-2 d-flex align-items-center justify-content-center"
                            >
                                <i
                                    class="fab fa-google-drive opacity-10"
                                    style="
                                        transform: scale(1.5);
                                        margin-left: 4px;
                                        margin-right: 4px;
                                    "
                                ></i>
                            </div>
                            <span class="nav-link-text ms-1">Drive</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white">
                            <div
                                class="text-white text-center me-2 d-flex align-items-center justify-content-center"
                            >
                                <i class="material-icons opacity-10"
                                    >view_in_ar</i
                                >
                            </div>
                            <span class="nav-link-text ms-1">Light/Dark</span>
                            <div class="mt-2 d-flex">
                                <div class="button ps-0 ms-auto my-auto">
                                    <input
                                        class="form-check-input mt-0 ms-auto"
                                        style="
                                            margin-left: 20px !important;
                                            margin-top: -1px !important;
                                        "
                                        type="checkbox"
                                        id="dark-version"
                                        onclick="darkMode(this)"
                                    />
                                </div>
                            </div>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="sidenav-footer position-absolute w-100 bottom-0">
                <div class="mx-3">
                    <button
                        class="btn btn-outline-primary mt-4 w-100"
                        id="logout"
                    >
                        Log Out
                    </button>
                </div>
            </div>
        </aside>
        <main
            class="main-content position-relative max-height-vh-100 h-100 border-radius-lg"
        >
            <!-- Navbar -->
            <nav
                class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl"
                id="navbarBlur"
                data-scroll="true"
            >
                <div class="container-fluid py-1 px-3">
                    <nav aria-label="breadcrumb">
                        <ol
                            class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5"
                        >
                            <li class="breadcrumb-item text-sm">
                                <a
                                    class="opacity-5 text-dark"
                                    href="javascript:;"
                                    >Pages</a
                                >
                            </li>
                            <li
                                class="breadcrumb-item text-sm text-dark active"
                                aria-current="page"
                            >
                                Dashboard
                            </li>
                        </ol>
                        <h6 class="font-weight-bolder mb-0">Dashboard</h6>
                    </nav>
                </div>
            </nav>
            <!-- End Navbar -->
            <div class="container-fluid py-4">
                <div class="row">
                    <div class="col-xl-4 col-sm-6 mb-xl-0 mb-4">
                        <div class="card">
                            <div class="card-header p-3 pt-2">
                                <div
                                    class="icon icon-lg icon-shape bg-gradient-dark shadow-dark text-center border-radius-xl mt-n4 position-absolute"
                                >
                                    <i class="material-icons opacity-10"
                                        >group</i
                                    >
                                </div>
                                <div class="text-end pt-1">
                                    <p class="text-sm mb-0 text-capitalize">
                                        My Writers
                                    </p>
                                    <h4 class="mb-0" id="my-writers">
                                        Loading...
                                    </h4>
                                </div>
                            </div>
                            <hr class="dark horizontal my-0" />
                            <div class="card-footer p-3">
                                <p class="mb-0"></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-4 col-sm-6 mb-xl-0 mb-4">
                        <div class="card">
                            <div class="card-header p-3 pt-2">
                                <div
                                    class="icon icon-lg icon-shape bg-gradient-primary shadow-primary text-center border-radius-xl mt-n4 position-absolute"
                                >
                                    <i class="material-icons opacity-10"
                                        >group_add</i
                                    >
                                </div>
                                <div class="text-end pt-1">
                                    <p class="text-sm mb-0 text-capitalize">
                                        Total Writers
                                    </p>
                                    <h4 class="mb-0" id="total-writers">
                                        Loading...
                                    </h4>
                                </div>
                            </div>
                            <hr class="dark horizontal my-0" />
                            <div class="card-footer p-3">
                                <p class="mb-0"></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-4 col-sm-6 mb-xl-0 mb-4">
                        <div class="card">
                            <div class="card-header p-3 pt-2">
                                <div
                                    class="icon icon-lg icon-shape bg-gradient-success shadow-success text-center border-radius-xl mt-n4 position-absolute"
                                >
                                    <i class="material-icons opacity-10"
                                        >assignment_turned_in</i
                                    >
                                </div>
                                <div class="text-end pt-1">
                                    <p class="text-sm mb-0 text-capitalize">
                                        Papers Done
                                    </p>
                                    <h4 class="mb-0" id="papers-done">
                                        Loading...
                                    </h4>
                                </div>
                            </div>
                            <hr class="dark horizontal my-0" />
                            <div class="card-footer p-3">
                                <p class="mb-0"></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" style="margin-top: 24px">
                    <div class="col-xl-12">
                        <div class="card">
                            <div class="card-header p-3">
                                <h4 class="mb-0">Drag and Drop Area</h4>
                            </div>
                            <div class="card-body">
                                <div
                                    id="drop-area"
                                    style="
                                        border: 2px dashed #ccc;
                                        padding: 20px;
                                        text-align: center;
                                    "
                                >
                                    <p>Drag & Drop files here</p>
                                    <input
                                        type="file"
                                        id="fileElem"
                                        multiple
                                        accept="*"
                                        style="display: none"
                                        onchange="handleFiles(this.files)"
                                    />
                                    <label class="button-drop" for="fileElem"
                                        >Select some files</label
                                    >
                                </div>
                                <progress
                                    id="progress-bar"
                                    max="100"
                                    value="0"
                                    style="width: 100%; display: none"
                                ></progress>
                                <div id="uploads"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <style>
            #user-info {
                font-weight: bold;
                font-size: larger;
                max-width: 100%;
                overflow-wrap: break-word;
            }
            #drop-area {
                border: 2px dashed #ccc;
                border-radius: 20px;
                width: 100%;
                max-width: 600px;
                margin: 50px auto;
                padding: 20px;
                text-align: center;
            }
            #drop-area.highlight {
                border-color: purple;
            }
            .button-drop {
                display: inline-block;
                padding: 10px 20px;
                margin: 10px;
                font-size: 16px;
                cursor: pointer;
                color: white;
                background-color: purple;
                border: none;
                border-radius: 5px;
            }
        </style>

        <!--   Core JS Files   -->
        <script src="../assets/js/core/popper.min.js"></script>
        <script src="../assets/js/core/bootstrap.min.js"></script>
        <script src="../assets/js/plugins/perfect-scrollbar.min.js"></script>
        <script src="../assets/js/plugins/smooth-scrollbar.min.js"></script>
        <script src="../assets/js/plugins/chartjs.min.js"></script>

        <script>
            var win = navigator.platform.indexOf("Win") > -1;
            if (win && document.querySelector("#sidenav-scrollbar")) {
                var options = {
                    damping: "0.5",
                };
                Scrollbar.init(
                    document.querySelector("#sidenav-scrollbar"),
                    options
                );
            }
        </script>
        <!-- Github buttons -->
        <script async defer src="https://buttons.github.io/buttons.js"></script>
        <!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
        <script src="../assets/js/material-dashboard.min.js?v=3.1.0"></script>
    </body>
</html>
<script type="module">
    const apiKey = "AIzaSyCsFBd6uMM1LuRCzc0DHbQoaREoqF8GLsg";
    const spreadsheetId = "1YDL_vWD_B6GV_ex_F-kp1fjYIz90CPQe6m3lHDWV0uE";
    const range = "Sheet1!A2:J"; // Dynamic range to cover all rows up to column J

    function fetchSheetData() {
        const loggedInUser = document.getElementById("user-info").textContent;
        console.log("for test:", loggedInUser);

        const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`;

        fetch(url)
            .then((response) => response.json())
            .then((data) => {
                if (data.values) {
                    const rows = data.values;
                    let myWriters = 0;
                    let totalWriters = rows.length;
                    let papersDone = 0;

                    rows.forEach((row) => {
                        const editor = row[6]; // Assuming Editor is in column B (index 1)
                        const status = row[9]; // Assuming Status is in column I (index 8)

                        if (editor === loggedInUser) {
                            myWriters++;
                        }
                        if (status && status.toLowerCase() === "complete") {
                            papersDone++;
                        }
                    });

                    document.getElementById("my-writers").innerText = myWriters;
                    document.getElementById("total-writers").innerText =
                        totalWriters;
                    document.getElementById("papers-done").innerText =
                        papersDone;
                } else {
                    console.error("No data found.");
                }
            })
            .catch((error) => {
                console.error("Error fetching data:", error);
            });
    }

    document.addEventListener("DOMContentLoaded", () => {
        // Listen for the custom event
        document.addEventListener("userInfoUpdated", (event) => {
            const loggedInUser = event.detail;
            console.log("Logged in user:", loggedInUser);
            fetchSheetData();

            // Now you can use loggedInUser as needed
            // For example, display additional information or perform further actions
        });
    });
</script>
