<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />
        <link
            rel="apple-touch-icon"
            sizes="76x76"
            href="../assets/img/apple-icon.png"
        />
        <link rel="icon" type="image/png" href="../assets/img/favicon.png" />
        <title>Dashboard</title>
        <link
            rel="stylesheet"
            type="text/css"
            href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900|Roboto+Slab:400,700"
        />
        <link href="../assets/css/nucleo-icons.css" rel="stylesheet" />
        <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
        <script
            src="https://kit.fontawesome.com/42d5adcbca.js"
            crossorigin="anonymous"
        ></script>
        <link
            href="https://fonts.googleapis.com/icon?family=Material+Icons+Round"
            rel="stylesheet"
        />
        <link
            id="pagestyle"
            href="../assets/css/material-dashboard.css?v=3.1.0"
            rel="stylesheet"
        />
        <script type="module" src="script.js"></script>
        <style>
            #sidebar-toggle {
                position: fixed;
                top: 20px;
                right: 20px; /* Move the toggle button to the right */
                z-index: 1050;
                transition: right 0.3s ease;
            }

            .sidenav {
                transition: transform 0.3s ease;
            }

            .g-sidenav-hidden .sidenav {
                transform: translateX(-250px);
            }

            .g-sidenav-hidden #sidebar-toggle {
                right: 20px; /* Adjust the toggle button position when sidebar is hidden */
            }

            .g-sidenav-show .sidenav {
                transform: translateX(0);
            }

            .g-sidenav-show #sidebar-toggle {
                right: 20px; /* Adjust the toggle button position when sidebar is shown */
            }

            @media (max-width: 991.98px) {
                .g-sidenav-hidden .sidenav {
                    transform: translateX(0px);
                }
                .g-sidenav-show .sidenav {
                    transform: translateX(0px);
                }
                .g-sidenav-hidden #sidebar-toggle {
                    right: 20px;
                }
                .g-sidenav-show #sidebar-toggle {
                    right: 20px;
                }
            }
            .card-drop {
                border: 1px solid #ddd;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                padding: 20px;
                background-color: #fff;
                width: 100%;
                max-width: 500px;
                text-align: center;
            }
            .card h3 {
                margin-bottom: 20px;
                font-size: 1.5em;
            }
            .drag-drop-area {
                border: 2px dashed #007bff;
                border-radius: 4px;
                padding: 20px;
                cursor: pointer;
                transition: background-color 0.2s, border-color 0.2s;
            }
            .drag-drop-area.dragover {
                background-color: #e9f5ff;
                border-color: #0056b3;
            }
            .drag-drop-area input[type="file"] {
                display: none;
            }
            .drag-drop-area p {
                margin: 0;
                font-size: 1.1em;
                color: #007bff;
            }
            .form-group {
                margin-top: 20px;
            }
            .form-group button {
                display: block;
                width: 100%;
                padding: 10px;
                background-color: #007bff;
                color: #fff;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 1em;
            }
            .form-group button:hover {
                background-color: #0056b3;
            }
        </style>
    </head>

    <body class="g-sidenav-show bg-gray-200">
        <button id="sidebar-toggle" class="btn btn-primary">
            <i class="material-icons">menu</i>
        </button>

        <aside
            class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-3 bg-gradient-dark"
            id="sidenav-main"
        >
            <div class="sidenav-header">
                <a class="navbar-brand m-0" target="_blank">
                    <div class="d-flex align-items-center">
                        <img
                            src="favicon.png"
                            class="navbar-brand-img h-100"
                            alt="main_logo"
                        />
                        <span
                            class="ms-1 font-weight-bold text-white"
                            style="margin-left: 15px !important"
                        >
                            <div id="user-info"></div>
                        </span>
                    </div>
                </a>
            </div>
            <hr class="horizontal light mt-0 mb-2" />
            <div
                class="collapse navbar-collapse w-auto"
                id="sidenav-collapse-main"
            >
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a
                            class="nav-link text-white active bg-gradient-primary"
                            href="../pages/dashboard.html"
                        >
                            <div
                                class="text-white text-center me-2 d-flex align-items-center justify-content-center"
                            >
                                <i class="material-icons opacity-10"
                                    >dashboard</i
                                >
                            </div>
                            <span class="nav-link-text ms-1">Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a
                            class="nav-link text-white"
                            href="https://app.slack.com/client/T06FM1QSH8A/C06LKC31QJD?cdn_fallback=1"
                            target="_blank"
                        >
                            <div
                                class="text-white text-center me-2 d-flex align-items-center justify-content-center"
                            >
                                <i
                                    class="fab fa-slack opacity-10"
                                    style="
                                        transform: scale(1.5);
                                        margin-left: 4px;
                                        margin-right: 4px;
                                    "
                                ></i>
                            </div>
                            <span class="nav-link-text ms-1">Slack</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a
                            class="nav-link text-white"
                            href="https://drive.google.com/drive/u/1/folders/1VSnhqMMidgB2dlyEJnsh_VU7P2gkNHOx"
                            target="_blank"
                        >
                            <div
                                class="text-white text-center me-2 d-flex align-items-center justify-content-center"
                            >
                                <i
                                    class="fab fa-google-drive opacity-10"
                                    style="
                                        transform: scale(1.5);
                                        margin-left: 4px;
                                        margin-right: 4px;
                                    "
                                ></i>
                            </div>
                            <span class="nav-link-text ms-1">Drive</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white">
                            <div
                                class="text-white text-center me-2 d-flex align-items-center justify-content-center"
                            >
                                <i class="material-icons opacity-10"
                                    >view_in_ar</i
                                >
                            </div>
                            <span class="nav-link-text ms-1">Light/Dark</span>
                            <div class="mt-2 d-flex">
                                <div class="button ps-0 ms-auto my-auto">
                                    <input
                                        class="form-check-input mt-0 ms-auto"
                                        style="
                                            margin-left: 20px !important;
                                            margin-top: -1px !important;
                                        "
                                        type="checkbox"
                                        id="dark-version"
                                        onclick="darkMode(this)"
                                    />
                                </div>
                            </div>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="sidenav-footer position-absolute w-100 bottom-0">
                <div class="mx-3">
                    <button
                        class="btn btn-outline-primary mt-4 w-100"
                        id="logout"
                    >
                        Log Out
                    </button>
                </div>
            </div>
        </aside>

        <main
            class="main-content position-relative max-height-vh-100 h-100 border-radius-lg"
        >
            <nav
                class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl"
                id="navbarBlur"
                data-scroll="true"
            >
                <div class="container-fluid py-1 px-3">
                    <nav aria-label="breadcrumb">
                        <ol
                            class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5"
                        >
                            <li class="breadcrumb-item text-sm">
                                <a
                                    class="opacity-5 text-dark"
                                    href="javascript:;"
                                    >Pages</a
                                >
                            </li>
                            <li
                                class="breadcrumb-item text-sm text-dark active"
                                aria-current="page"
                            >
                                Dashboard
                            </li>
                        </ol>
                        <h6 class="font-weight-bolder mb-0">Dashboard</h6>
                    </nav>
                </div>
            </nav>
            <div class="container-fluid py-4">
                <div class="row">
                    <div class="col-xl-4 col-sm-6 mb-xl-0 mb-4">
                        <div class="card">
                            <div class="card-header p-3 pt-2">
                                <div
                                    class="icon icon-lg icon-shape bg-gradient-dark shadow-dark text-center border-radius-xl mt-n4 position-absolute"
                                >
                                    <i class="material-icons opacity-10"
                                        >group</i
                                    >
                                </div>
                                <div class="text-end pt-1">
                                    <p class="text-sm mb-0 text-capitalize">
                                        My Writers
                                    </p>
                                    <h4 class="mb-0" id="my-writers">
                                        Loading...
                                    </h4>
                                </div>
                            </div>
                            <hr class="dark horizontal my-0" />
                            <div class="card-footer p-3">
                                <p class="mb-0"></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-4 col-sm-6 mb-xl-0 mb-4">
                        <div class="card">
                            <div class="card-header p-3 pt-2">
                                <div
                                    class="icon icon-lg icon-shape bg-gradient-primary shadow-primary text-center border-radius-xl mt-n4 position-absolute"
                                >
                                    <i class="material-icons opacity-10"
                                        >group_add</i
                                    >
                                </div>
                                <div class="text-end pt-1">
                                    <p class="text-sm mb-0 text-capitalize">
                                        Total Writers
                                    </p>
                                    <h4 class="mb-0" id="total-writers">
                                        Loading...
                                    </h4>
                                </div>
                            </div>
                            <hr class="dark horizontal my-0" />
                            <div class="card-footer p-3">
                                <p class="mb-0"></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-4 col-sm-6 mb-xl-0 mb-4">
                        <div class="card">
                            <div class="card-header p-3 pt-2">
                                <div
                                    class="icon icon-lg icon-shape bg-gradient-success shadow-success text-center border-radius-xl mt-n4 position-absolute"
                                >
                                    <i class="material-icons opacity-10"
                                        >assignment_turned_in</i
                                    >
                                </div>
                                <div class="text-end pt-1">
                                    <p class="text-sm mb-0 text-capitalize">
                                        Papers Done
                                    </p>
                                    <h4 class="mb-0" id="papers-done">
                                        Loading...
                                    </h4>
                                </div>
                            </div>
                            <hr class="dark horizontal my-0" />
                            <div class="card-footer p-3">
                                <p class="mb-0"></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12" style="margin-top: 48px">
                    <div class="card my-4">
                        <div
                            class="card-header p-0 position-relative mt-n4 mx-3 z-index-2"
                        >
                            <div
                                class="bg-gradient-primary shadow-primary border-radius-lg pt-4 pb-3"
                            >
                                <h6 class="text-white text-capitalize ps-3">
                                    My Writers
                                </h6>
                            </div>
                        </div>
                        <div class="card-body px-0 pb-2">
                            <div class="table-responsive p-0">
                                <table
                                    class="table align-items-center mb-0"
                                    id="writersTable"
                                >
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Proposal</th>
                                            <th>Last Checkin</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12" style="margin-top: 48px; justify-content: center;">
                    <div class="card-drop my-4">
                        <h3>Upload and Convert File</h3>
                        <form id="uploadForm">
                            <div class="drag-drop-area" id="dragDropArea">
                                <input
                                    type="file"
                                    id="fileInput"
                                    name="file"
                                    accept=".txt"
                                />
                                <p>
                                    Drag & Drop your file here or click to
                                    select
                                </p>
                            </div>
                            <div class="form-group">
                                <button
                                    type="button"
                                    id="convertButton"
                                    style="display: none"
                                >
                                    Convert
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>

        <script src="../assets/js/core/popper.min.js"></script>
        <script src="../assets/js/core/bootstrap.min.js"></script>
        <script src="../assets/js/plugins/perfect-scrollbar.min.js"></script>
        <script src="../assets/js/plugins/smooth-scrollbar.min.js"></script>
        <script src="../assets/js/plugins/chartjs.min.js"></script>
        <script src="../assets/js/material-dashboard.min.js?v=3.1.0"></script>
        <script src="https://buttons.github.io/buttons.js" async defer></script>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const body = document.body;
                const sidebarToggle = document.getElementById("sidebar-toggle");

                function toggleSidebar() {
                    body.classList.toggle("g-sidenav-hidden");
                    body.classList.toggle("g-sidenav-show");
                }

                sidebarToggle.addEventListener("click", toggleSidebar);

                var win = navigator.platform.indexOf("Win") > -1;
                if (win && document.querySelector("#sidenav-scrollbar")) {
                    var options = {
                        damping: "0.5",
                    };
                    Scrollbar.init(
                        document.querySelector("#sidenav-scrollbar"),
                        options
                    );
                }
            });
        </script>

        <script type="module">
            const apiKey = "AIzaSyCsFBd6uMM1LuRCzc0DHbQoaREoqF8GLsg";
            const spreadsheetId =
                "1YDL_vWD_B6GV_ex_F-kp1fjYIz90CPQe6m3lHDWV0uE";
            const range = "Sheet1!A2:J";

            function fetchSheetData() {
                const loggedInUser =
                    document.getElementById("user-info").textContent;
                console.log("for test:", loggedInUser);

                const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`;

                fetch(url)
                    .then((response) => response.json())
                    .then((data) => {
                        if (data.values) {
                            const rows = data.values;
                            let myWriters = 0;
                            let totalWriters = rows.length;
                            let papersDone = 0;
                            const writersTableBody = document
                                .getElementById("writersTable")
                                .querySelector("tbody");

                            // Clear the table before appending new rows
                            writersTableBody.innerHTML = "";

                            rows.forEach((row) => {
                                const editor = row[6]; // Assuming the editor is in column 6
                                const status = row[9]; // Assuming the status is in column 9

                                if (editor === loggedInUser) {
                                    myWriters++;

                                    // Create a new row
                                    const newRow = document.createElement("tr");

                                    // Append only columns 1, 2, 4, 8, and 9
                                    [1, 2, 4, 8, 9].forEach((index) => {
                                        const newCell =
                                            document.createElement("td");
                                        let cellContent = row[index];

                                        // Truncate column 4 (index 3) to 75 characters
                                        if (
                                            index === 4 &&
                                            cellContent.length > 75
                                        ) {
                                            cellContent =
                                                cellContent.substring(0, 75) +
                                                "...";
                                        }

                                        newCell.textContent = cellContent;
                                        newRow.appendChild(newCell);
                                    });

                                    // Append the row to the table body
                                    writersTableBody.appendChild(newRow);
                                }

                                if (
                                    status &&
                                    status.toLowerCase() === "complete"
                                ) {
                                    papersDone++;
                                }
                            });

                            document.getElementById("my-writers").innerText =
                                myWriters;
                            document.getElementById("total-writers").innerText =
                                totalWriters;
                            document.getElementById("papers-done").innerText =
                                papersDone;
                        } else {
                            console.error("No data found.");
                        }
                    })
                    .catch((error) => {
                        console.error("Error fetching data:", error);
                    });
            }

            document.addEventListener("DOMContentLoaded", () => {
                document.addEventListener("userInfoUpdated", (event) => {
                    const loggedInUser = event.detail;
                    console.log("Logged in user:", loggedInUser);
                    fetchSheetData();
                });
            });
        </script>
        <script src="converter.js"></script>
        <script>
            const dragDropArea = document.getElementById("dragDropArea");
            const fileInput = document.getElementById("fileInput");
            const convertButton = document.getElementById("convertButton");
            let selectedFile;

            dragDropArea.addEventListener("dragover", (e) => {
                e.preventDefault();
                dragDropArea.classList.add("dragover");
            });

            dragDropArea.addEventListener("dragleave", () => {
                dragDropArea.classList.remove("dragover");
            });

            dragDropArea.addEventListener("drop", (e) => {
                e.preventDefault();
                dragDropArea.classList.remove("dragover");
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files;
                    selectedFile = files[0];
                    convertButton.style.display = "block";
                }
            });

            dragDropArea.addEventListener("click", () => {
                fileInput.click();
            });

            fileInput.addEventListener("change", () => {
                if (fileInput.files.length > 0) {
                    selectedFile = fileInput.files[0];
                    convertButton.style.display = "block";
                }
            });

            convertButton.addEventListener("click", () => {
                if (selectedFile) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const text = e.target.result;
                        convertTextToLatexAndPDF(
                            text,
                            selectedFile.name.replace(".txt", ".pdf")
                        );
                    };
                    reader.readAsText(selectedFile);
                }
            });
        </script>
    </body>
</html>
